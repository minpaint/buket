{% extends "shop/base.html" %}
{% block title %}–ö–æ–Ω—Ç–∞–∫—Ç—ã –º–∞–≥–∞–∑–∏–Ω–æ–≤ ‚Äî Buket.by{% endblock %}

{% block extra_styles %}
<style>
  .contacts-wrap{max-width:1280px;margin:0 auto;padding:32px 20px 48px}
  .contacts-title{font-size:28px;font-weight:700;color:var(--PrimaryDark);margin-bottom:8px}
  .contacts-sub{color:#6b7280;font-size:15px;margin-bottom:36px}

  .stores-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(560px,1fr));gap:28px}

  .store-card{
    border:1px solid #e5e7eb;border-radius:16px;overflow:hidden;
    background:#fff;box-shadow:0 4px 16px rgba(0,0,0,.06);
  }
  .store-header{
    background:var(--SoftBg);padding:20px 24px 16px;
    border-bottom:1px solid #e5e7eb;
  }
  .store-name{font-size:20px;font-weight:700;color:var(--PrimaryDark);margin:0 0 4px}
  .store-hours{font-size:13px;color:#6b7280;margin:0}

  .store-body{padding:20px 24px}

  .store-address{
    display:flex;gap:8px;align-items:flex-start;
    font-size:14px;color:#374151;margin-bottom:14px;
  }
  .store-address-icon{font-size:18px;flex-shrink:0;margin-top:1px}

  .store-phones{display:flex;flex-direction:column;gap:6px;margin-bottom:16px}
  .store-phone-row{display:flex;align-items:center;gap:8px;font-size:15px}
  .store-phone-emoji{font-size:18px;flex-shrink:0}
  .store-phone-label{color:#6b7280;font-size:13px;margin-right:2px}
  .store-phone-number{color:var(--PrimaryDark);font-weight:600;text-decoration:none}
  .store-phone-number:hover{text-decoration:underline}

  .store-desc{font-size:14px;color:#4b5563;margin-bottom:18px;line-height:1.6}

  /* –§–æ—Ç–æ –∏–Ω—Ç–µ—Ä—å–µ—Ä–æ–≤ */
  .store-photos{
    display:flex;gap:8px;overflow-x:auto;margin-bottom:18px;
    scrollbar-width:thin;scrollbar-color:#d1d5db transparent;
    padding-bottom:4px;
  }
  .store-photos::-webkit-scrollbar{height:4px}
  .store-photos::-webkit-scrollbar-thumb{background:#d1d5db;border-radius:4px}
  .store-photo{
    flex-shrink:0;width:120px;height:90px;
    object-fit:cover;border-radius:8px;cursor:pointer;
    border:1px solid #e5e7eb;transition:opacity .2s;
  }
  .store-photo:hover{opacity:.85}

  /* –ö–∞—Ä—Ç–∞ */
  .store-map{
    width:100%;height:240px;border:0;border-radius:10px;
    display:block;margin-top:4px;
  }

  /* –õ–∞–π—Ç–±–æ–∫—Å */
  .lightbox{
    display:none;position:fixed;inset:0;background:rgba(0,0,0,.85);
    z-index:500;align-items:center;justify-content:center;
  }
  .lightbox.open{display:flex}
  .lightbox img{max-width:90vw;max-height:90vh;border-radius:10px;object-fit:contain}
  .lb-close{
    position:absolute;top:16px;right:24px;
    font-size:36px;color:#fff;cursor:pointer;line-height:1;
    background:none;border:none;
  }

  @media(max-width:640px){
    .stores-grid{grid-template-columns:1fr}
    .store-header,.store-body{padding:16px}
    .contacts-title{font-size:22px}
  }
</style>
{% endblock %}

{% block content %}
<div class="contacts-wrap">
  <h1 class="contacts-title">–ö–æ–Ω—Ç–∞–∫—Ç—ã –º–∞–≥–∞–∑–∏–Ω–æ–≤</h1>
  <p class="contacts-sub">–í—ã–±–µ—Ä–∏—Ç–µ —É–¥–æ–±–Ω—ã–π –º–∞–≥–∞–∑–∏–Ω ‚Äî –∑–∞–∫–∞–∂–∏—Ç–µ –±—É–∫–µ—Ç –∏–ª–∏ –ø—Ä–∏—Ö–æ–¥–∏—Ç–µ –≤—ã–±—Ä–∞—Ç—å —Å–∞–º–∏</p>

  {% if stores %}
  <div class="stores-grid">
    {% for store in stores %}
    <div class="store-card">
      <div class="store-header">
        <p class="store-name">{{ store.name }}</p>
        {% if store.working_hours %}
        <p class="store-hours">üïê {{ store.working_hours }}</p>
        {% endif %}
      </div>
      <div class="store-body">

        {% if store.address %}
        <div class="store-address">
          <span class="store-address-icon">üìç</span>
          <span>{{ store.address }}</span>
        </div>
        {% endif %}

        {% if store.phones.all %}
        <div class="store-phones">
          {% for ph in store.phones.all %}
          <div class="store-phone-row">
            <span class="store-phone-emoji">{{ ph.emoji }}</span>
            {% if ph.label %}<span class="store-phone-label">{{ ph.label }}:</span>{% endif %}
            <a class="store-phone-number" href="tel:{{ ph.number|cut:' ' }}">{{ ph.number }}</a>
          </div>
          {% endfor %}
        </div>
        {% endif %}

        {% if store.description %}
        <p class="store-desc">{{ store.description }}</p>
        {% endif %}

        {% if store.photos.all %}
        <div class="store-photos">
          {% for photo in store.photos.all %}
          <img class="store-photo" src="{{ photo.image.url }}" alt="{{ photo.caption|default:store.name }}"
               onclick="openLightbox('{{ photo.image.url }}')" title="{{ photo.caption }}">
          {% endfor %}
        </div>
        {% endif %}

        {% if store.map_embed_url %}
        <iframe class="store-map" src="{{ store.map_embed_url }}"
                allowfullscreen loading="lazy"
                referrerpolicy="no-referrer-when-downgrade"></iframe>
        {% endif %}

      </div>
    </div>
    {% endfor %}
  </div>
  {% else %}
  <p style="color:#6b7280;font-size:16px">–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –º–∞–≥–∞–∑–∏–Ω–∞—Ö —Å–∫–æ—Ä–æ –ø–æ—è–≤–∏—Ç—Å—è.</p>
  {% endif %}
</div>

<!-- –õ–∞–π—Ç–±–æ–∫—Å –¥–ª—è —Ñ–æ—Ç–æ -->
<div class="lightbox" id="lightbox" onclick="closeLightbox()">
  <button class="lb-close" onclick="closeLightbox()">√ó</button>
  <img id="lightboxImg" src="" alt="–§–æ—Ç–æ –º–∞–≥–∞–∑–∏–Ω–∞">
</div>
{% endblock %}

{% block extra_scripts %}
<script>
  function openLightbox(src) {
    document.getElementById('lightboxImg').src = src;
    document.getElementById('lightbox').classList.add('open');
    document.body.style.overflow = 'hidden';
  }
  function closeLightbox() {
    document.getElementById('lightbox').classList.remove('open');
    document.body.style.overflow = '';
  }
  document.addEventListener('keydown', function(e){
    if (e.key === 'Escape') closeLightbox();
  });
</script>
{% endblock %}
