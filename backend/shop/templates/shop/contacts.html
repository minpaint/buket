{% extends "shop/base.html" %}
{% block title %}–ö–æ–Ω—Ç–∞–∫—Ç—ã –º–∞–≥–∞–∑–∏–Ω–æ–≤ ‚Äî Buket.by{% endblock %}

{% block extra_styles %}
<style>
  .contacts-wrap{max-width:1280px;margin:0 auto;padding:32px 20px 56px}
  .contacts-title{font-size:28px;font-weight:700;color:var(--PrimaryDark);margin-bottom:6px}
  .contacts-sub{color:#6b7280;font-size:15px;margin-bottom:36px}

  /* –°–ø–∏—Å–æ–∫ –º–∞–≥–∞–∑–∏–Ω–æ–≤ ‚Äî –æ–¥–Ω–∞ –∫–æ–ª–æ–Ω–∫–∞, –∫–∞–∂–¥–∞—è –∫–∞—Ä—Ç–æ—á–∫–∞ –ø–æ–ª–Ω–∞—è —à–∏—Ä–∏–Ω–∞ */
  .stores-list{display:flex;flex-direction:column;gap:28px}

  .store-card{
    border:1px solid #e5e7eb;border-radius:16px;overflow:hidden;
    background:#fff;box-shadow:0 4px 16px rgba(0,0,0,.06);
  }
  .store-header{
    background:var(--SoftBg);padding:18px 24px 14px;
    border-bottom:1px solid #e5e7eb;
  }
  .store-name{font-size:20px;font-weight:700;color:var(--PrimaryDark);margin:0 0 4px}
  .store-hours{font-size:13px;color:#6b7280;margin:0}

  /* –î–≤–µ –∫–æ–ª–æ–Ω–∫–∏: –∏–Ω—Ñ–æ + —Ñ–æ—Ç–æ */
  .store-columns{display:grid;grid-template-columns:1fr 1fr;gap:0}

  .store-info{padding:20px 24px}

  .store-address{
    display:flex;gap:8px;align-items:flex-start;
    font-size:14px;color:#374151;margin-bottom:14px;
  }
  .store-address-icon{font-size:18px;flex-shrink:0;margin-top:1px}

  .store-phones{display:flex;flex-direction:column;gap:6px;margin-bottom:16px}
  .store-phone-row{display:flex;align-items:center;gap:8px;font-size:15px}
  .store-phone-emoji{font-size:18px;flex-shrink:0}
  .store-phone-label{color:#6b7280;font-size:13px;margin-right:2px}
  .store-phone-number{color:var(--PrimaryDark);font-weight:600;text-decoration:none}
  .store-phone-number:hover{text-decoration:underline}

  .store-desc{font-size:14px;color:#4b5563;margin-bottom:18px;line-height:1.6}

  /* –ö–∞—Ä—Ç–∞ */
  .store-map{
    width:100%;height:220px;border:0;border-radius:10px;
    display:block;margin-top:4px;
  }

  /* –§–æ—Ç–æ ‚Äî –ø—Ä–∞–≤–∞—è –∫–æ–ª–æ–Ω–∫–∞ */
  .store-photos-col{
    border-left:1px solid #e5e7eb;
    padding:16px;
    display:flex;flex-direction:column;gap:8px;
    background:#fafafa;
  }
  .store-photos-grid{
    display:grid;
    grid-template-columns:1fr 1fr;
    gap:8px;
    height:100%;
    align-content:start;
  }
  .store-photos-grid.single{grid-template-columns:1fr}
  .store-photo{
    width:100%;aspect-ratio:1/1;
    object-fit:cover;border-radius:10px;cursor:pointer;
    border:1px solid #e5e7eb;transition:opacity .2s,transform .2s;
    display:block;
  }
  .store-photo:hover{opacity:.88;transform:scale(1.02)}

  /* –ö–∞—Ä—Ç–æ—á–∫–∞ –±–µ–∑ —Ñ–æ—Ç–æ ‚Äî –æ–¥–Ω–∞ –∫–æ–ª–æ–Ω–∫–∞ */
  .store-card.no-photos .store-columns{grid-template-columns:1fr}
  .store-card.no-photos .store-photos-col{display:none}

  /* –õ–∞–π—Ç–±–æ–∫—Å */
  .lightbox{
    display:none;position:fixed;inset:0;background:rgba(0,0,0,.88);
    z-index:500;align-items:center;justify-content:center;
  }
  .lightbox.open{display:flex}
  .lightbox img{max-width:92vw;max-height:92vh;border-radius:10px;object-fit:contain}
  .lb-close{
    position:absolute;top:16px;right:24px;
    font-size:36px;color:#fff;cursor:pointer;line-height:1;
    background:none;border:none;
  }

  @media(max-width:900px){
    .store-columns{grid-template-columns:1fr}
    .store-photos-col{border-left:none;border-top:1px solid #e5e7eb}
    .store-photos-grid{grid-template-columns:1fr 1fr 1fr}
    .store-photos-grid.single{grid-template-columns:1fr}
  }
  @media(max-width:600px){
    .contacts-title{font-size:22px}
    .store-header,.store-info{padding:14px 16px}
    .store-photos-col{padding:12px}
    .store-photos-grid{grid-template-columns:1fr 1fr}
    .store-map{height:180px}
  }
</style>
{% endblock %}

{% block content %}
<div class="contacts-wrap">
  <h1 class="contacts-title">–ö–æ–Ω—Ç–∞–∫—Ç—ã –º–∞–≥–∞–∑–∏–Ω–æ–≤</h1>
  <p class="contacts-sub">–í—ã–±–µ—Ä–∏—Ç–µ —É–¥–æ–±–Ω—ã–π –º–∞–≥–∞–∑–∏–Ω ‚Äî –∑–∞–∫–∞–∂–∏—Ç–µ –±—É–∫–µ—Ç –∏–ª–∏ –ø—Ä–∏—Ö–æ–¥–∏—Ç–µ –≤—ã–±—Ä–∞—Ç—å —Å–∞–º–∏</p>

  {% if stores %}
  <div class="stores-list">
    {% for store in stores %}
    <div class="store-card{% if not store.photos.all %} no-photos{% endif %}">

      <div class="store-header">
        <p class="store-name">{{ store.name }}</p>
        {% if store.working_hours %}
        <p class="store-hours">üïê {{ store.working_hours }}</p>
        {% endif %}
      </div>

      <div class="store-columns">

        <!-- –õ–µ–≤–∞—è: –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è -->
        <div class="store-info">
          {% if store.address %}
          <div class="store-address">
            <span class="store-address-icon">üìç</span>
            <span>{{ store.address }}</span>
          </div>
          {% endif %}

          {% if store.phones.all %}
          <div class="store-phones">
            {% for ph in store.phones.all %}
            <div class="store-phone-row">
              <span class="store-phone-emoji">{{ ph.emoji }}</span>
              {% if ph.label %}<span class="store-phone-label">{{ ph.label }}:</span>{% endif %}
              <a class="store-phone-number" href="tel:{{ ph.number|cut:' ' }}">{{ ph.number }}</a>
            </div>
            {% endfor %}
          </div>
          {% endif %}

          {% if store.description %}
          <p class="store-desc">{{ store.description }}</p>
          {% endif %}

          {% if store.map_embed_url %}
          <iframe class="store-map" src="{{ store.map_embed_url }}"
                  allowfullscreen loading="lazy"
                  referrerpolicy="no-referrer-when-downgrade"></iframe>
          {% endif %}
        </div>

        <!-- –ü—Ä–∞–≤–∞—è: —Ñ–æ—Ç–æ -->
        {% if store.photos.all %}
        <div class="store-photos-col">
          <div class="store-photos-grid{% if store.photos.all|length == 1 %} single{% endif %}">
            {% for photo in store.photos.all %}
            <img class="store-photo"
                 src="{{ photo.image.url }}"
                 alt="{{ photo.caption|default:store.name }}"
                 onclick="openLightbox('{{ photo.image.url }}')"
                 title="{{ photo.caption }}">
            {% endfor %}
          </div>
        </div>
        {% endif %}

      </div><!-- /store-columns -->
    </div>
    {% endfor %}
  </div>
  {% else %}
  <p style="color:#6b7280;font-size:16px">–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –º–∞–≥–∞–∑–∏–Ω–∞—Ö —Å–∫–æ—Ä–æ –ø–æ—è–≤–∏—Ç—Å—è.</p>
  {% endif %}
</div>

<!-- –õ–∞–π—Ç–±–æ–∫—Å -->
<div class="lightbox" id="lightbox" onclick="closeLightbox()">
  <button class="lb-close" onclick="closeLightbox()">√ó</button>
  <img id="lightboxImg" src="" alt="–§–æ—Ç–æ –º–∞–≥–∞–∑–∏–Ω–∞">
</div>
{% endblock %}

{% block extra_scripts %}
<script>
  function openLightbox(src) {
    document.getElementById('lightboxImg').src = src;
    document.getElementById('lightbox').classList.add('open');
    document.body.style.overflow = 'hidden';
  }
  function closeLightbox() {
    document.getElementById('lightbox').classList.remove('open');
    document.body.style.overflow = '';
  }
  document.addEventListener('keydown', function(e){
    if (e.key === 'Escape') closeLightbox();
  });
</script>
{% endblock %}
