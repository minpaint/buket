{% extends "shop/base.html" %}
{% block title %}Buket{% endblock %}
{% block extra_styles %}
<style>
  .container{max-width:1280px;margin:0 auto;padding:0 20px}
  .hero{position:relative;min-height:52vh;background:#1f2937;color:#fff;overflow:hidden}
  .hero-bg{position:absolute;inset:0;background-size:cover;background-position:center;opacity:1;transition:opacity .5s}
  .hero-inner{position:relative;z-index:1;display:flex;min-height:52vh;align-items:center;justify-content:center;padding:28px 16px}
  .hero-card{max-width:860px;border:1px solid rgba(255,255,255,.28);background:linear-gradient(to bottom,rgba(8,15,22,.52),rgba(8,15,22,.68));backdrop-filter:blur(10px);border-radius:28px;padding:26px 24px;text-align:center;color:#fff;box-shadow:0 14px 36px rgba(0,0,0,.35)}
  .hero-card h1{margin:6px 0 10px;font-size:44px;line-height:1.15}
  .hero-card p{margin:0;color:rgba(255,255,255,.9);font-size:18px}
  .hero-card .desc-text{color:rgba(255,255,255,.9)}
  .hero-btn{display:inline-block;margin-top:20px;background:var(--Accent);color:#fff;border-radius:999px;padding:12px 26px;font-weight:700}
  .hero-nav{position:absolute;top:50%;transform:translateY(-50%);z-index:2;width:42px;height:42px;border:none;border-radius:999px;background:rgba(255,255,255,.8);cursor:pointer;font-weight:700}
  .hero-prev{left:14px}.hero-next{right:14px}
  .hero-dots{position:absolute;left:50%;transform:translateX(-50%);bottom:14px;display:flex;gap:8px;z-index:2}
  .hero-dot{width:10px;height:10px;border-radius:50%;background:rgba(255,255,255,.65);border:none;cursor:pointer}
  .hero-dot.active{width:30px;border-radius:999px;background:#fff}
  .section{padding:34px 0}
  .showcase-wrap{border:1px solid rgba(34,139,34,.2);border-radius:18px;background:#fff;padding:20px}
  .title{font-size:38px;color:var(--PrimaryDark);margin:0}
  .subtitle{color:#000;margin:10px 0 0;font-size:16px}
  .grid{display:grid;gap:16px}
  .grid-4{grid-template-columns:repeat(auto-fill,minmax(220px,1fr))}
  .showcase-grid{grid-template-columns:repeat(4,1fr)}
  @media(max-width:900px){.showcase-grid{grid-template-columns:repeat(2,1fr)}}
  @media(max-width:360px){.showcase-grid{grid-template-columns:1fr 1fr}}
  .grid-3{grid-template-columns:repeat(auto-fit,minmax(260px,1fr))}
  .product-card,.category-card,.review-card{background:#fff;border:1px solid rgba(34,139,34,.14);border-radius:14px;overflow:hidden;box-shadow:0 10px 24px rgba(16,24,40,.08);transition:all .3s;display:flex;flex-direction:column}
  .product-card:hover,.category-card:hover,.review-card:hover{box-shadow:0 16px 30px rgba(16,24,40,.16)}
  .media{position:relative;width:100%;aspect-ratio:1/1;background:var(--SoftBg);overflow:hidden;flex-shrink:0}
  .media img{position:absolute;inset:0;width:100%;height:100%;object-fit:cover;transition:opacity .3s}
  .media .hover{opacity:0}
  .card:hover .media .hover{opacity:1}
  .card:hover .media .main{opacity:0}
  .pad{padding:12px 14px;flex:1;display:flex;flex-direction:column;justify-content:space-between}
  .name{font-size:15px;font-weight:600;color:var(--PrimaryDark);margin:0 0 8px;line-height:1.35;flex:1}
  .price-tag{margin:0;display:inline-flex;align-items:baseline;gap:3px;flex-shrink:0}
  .price-amount{font-size:18px;font-weight:700;color:var(--PrimaryDark);line-height:1}
  .price-currency{font-size:11px;font-weight:600;color:var(--PrimaryDark);opacity:.7;letter-spacing:.04em;text-transform:uppercase}
  .price-row{display:flex;align-items:center;justify-content:space-between;gap:6px;margin-top:4px}
  .badge-instock{
    position:absolute;top:12px;left:0;
    background:linear-gradient(135deg,#ea580c,#f97316);
    color:#fff;font-size:11px;font-weight:700;
    padding:4px 10px 4px 10px;
    border-radius:0 999px 999px 0;
    box-shadow:0 2px 8px rgba(249,115,22,.35);
    letter-spacing:.03em;
    display:inline-flex;align-items:center;gap:5px;
    line-height:1.4;
    z-index:2;
  }
  .badge-instock::before{content:'‚ú¶';font-size:9px;opacity:.9}
  .order-btn{
    flex-shrink:0;
    background:#166534;color:#fff;
    border:none;border-radius:999px;cursor:pointer;
    font-size:12px;font-weight:700;
    padding:6px 12px;
    display:inline-flex;align-items:center;
    transition:background .2s;
    white-space:nowrap;
    position:relative;z-index:2;
  }
  .order-btn:hover{background:#14532d}
  .order-btn.in-cart{background:#f97316}
  @media(max-width:560px){.order-btn{font-size:11px;padding:5px 10px}}
  .action-center{text-align:center;margin-top:20px}
  .btn-main{display:inline-block;background:var(--Primary);color:#fff;border-radius:999px;padding:12px 24px}
  /* Per-store showcase */
  .store-showcase{margin-bottom:28px}
  .store-showcase:last-child{margin-bottom:0}
  /* –ü–ª–∞—à–∫–∞ –º–∞–≥–∞–∑–∏–Ω–∞ */
  .store-showcase-header{
    display:flex;align-items:center;justify-content:space-between;gap:12px;
    margin-bottom:14px;flex-wrap:wrap;
    background:#f0faf2;border:1px solid #c6e8cc;
    border-radius:12px;padding:12px 16px;
  }
  .store-showcase-meta{flex:1;min-width:0;display:flex;align-items:center;gap:10px}
  .store-showcase-icon{
    width:36px;height:36px;border-radius:50%;
    background:#d1f0d8;
    display:flex;align-items:center;justify-content:center;
    font-size:17px;flex-shrink:0;
  }
  .store-showcase-texts{min-width:0}
  .store-showcase-name{font-size:15px;font-weight:700;color:var(--PrimaryDark);margin:0 0 2px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
  .store-showcase-addr{font-size:12px;color:#6b7280;margin:0;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
  .btn-see-all{
    display:inline-flex;align-items:center;gap:5px;
    background:#fff;border:1px solid #c6e8cc;
    color:var(--PrimaryDark);border-radius:999px;padding:7px 16px;
    font-size:13px;font-weight:600;white-space:nowrap;flex-shrink:0;
    transition:background .15s;
  }
  .btn-see-all:hover{background:#e8f5e9}
  .showcase-divider{border:none;border-top:1px solid rgba(34,139,34,.12);margin:24px 0 0}
  @media(max-width:560px){
    .store-showcase-name{font-size:14px}
    .store-showcase-header{padding:10px 12px;gap:8px}
    .btn-see-all{font-size:12px;padding:6px 12px}
    .store-showcase-icon{width:32px;height:32px;font-size:15px}
  }
  .reviews-wrap{margin-top:20px;border:1px solid rgba(34,139,34,.15);border-radius:16px;background:#fff;padding:20px}
  .review-top{display:flex;align-items:center;gap:10px}
  .avatar{width:40px;height:40px;border-radius:50%;background:#d1fae5;object-fit:cover}
  .stars{color:#f59e0b;letter-spacing:1px;font-size:14px}
  .stores{display:flex;gap:8px;flex-wrap:wrap;margin-top:14px}
  .store-chip{background:#f3f4f6;border-radius:999px;padding:6px 10px;font-size:13px}
  /* –°–ª–∞–π–¥–µ—Ä –æ—Ç–∑—ã–≤–æ–≤ */
  .reviews-slider-wrap{position:relative;margin-top:16px}
  .reviews-track-outer{overflow:hidden}
  .reviews-track{display:flex;gap:16px;transition:transform .35s ease}
  .reviews-track .review-card{flex:0 0 calc(33.333% - 11px);min-width:0}
  .reviews-nav{display:flex;gap:8px;justify-content:flex-end;align-items:center;margin-top:14px}
  .reviews-arrow{
    width:36px;height:36px;border-radius:50%;border:1px solid #d1e8d4;
    background:#fff;cursor:pointer;font-size:16px;line-height:1;
    display:inline-flex;align-items:center;justify-content:center;
    color:var(--PrimaryDark);transition:background .15s,border-color .15s;flex-shrink:0;
  }
  .reviews-arrow:hover{background:var(--SoftBg);border-color:var(--PrimaryDark)}
  .reviews-dots{display:flex;gap:6px;align-items:center}
  .reviews-dot{width:8px;height:8px;border-radius:50%;background:#d1e8d4;border:none;cursor:pointer;padding:0;transition:background .2s,width .2s}
  .reviews-dot.active{background:var(--PrimaryDark);width:22px;border-radius:999px}
  @media(max-width:900px){.reviews-track .review-card{flex:0 0 calc(50% - 8px)}}
  @media(max-width:560px){.reviews-track .review-card{flex:0 0 100%}}
  @media (max-width:900px){
    .container{padding:0 12px}
    .section{padding:22px 0}
    .showcase-wrap,.reviews-wrap{padding:14px}
    .hero-card h1{font-size:32px}
    .title{font-size:30px}
    .grid-4{grid-template-columns:1fr 1fr}
    .store-showcase-header{gap:8px}
    /* –ø–ª–∞–Ω—à–µ—Ç ‚Äî 2 –∫–æ–ª–æ–Ω–∫–∏ */
  }
  .price-undef{font-size:13px;color:#6b7280;font-style:italic}
  /* –°–∫—Ä—ã—Ç—å –∫–∞—Ä—Ç–æ—á–∫–∏ –≤–∏—Ç—Ä–∏–Ω—ã –ø–æ—Å–ª–µ 4-–π –Ω–∞ –¥–µ—Å–∫—Ç–æ–ø–µ —Ç–æ–∂–µ */
  .showcase-grid:not(.expanded) .showcase-card:nth-child(n+5){display:none}
  /* –ö–Ω–æ–ø–∫–∞ ¬´–°–º–æ—Ç—Ä–µ—Ç—å –≤—Å—é –≤–∏—Ç—Ä–∏–Ω—É¬ª */
  .btn-expand-showcase{
    display:block;
    margin:12px auto 0;
    background:var(--SoftBg);border:1px solid #d1e8d4;
    color:var(--PrimaryDark);border-radius:999px;
    padding:8px 20px;font-size:13px;font-weight:600;
    cursor:pointer;transition:background .15s;
  }
  .btn-expand-showcase:hover{background:#e8f5e9}
  @media (max-width:560px){
    .hero{min-height:42vh}
    .hero-inner{min-height:42vh;padding:20px 12px}
    .hero-card{padding:16px 14px;border-radius:18px}
    .hero-card h1{font-size:24px}
    .hero-card p{font-size:15px}
    .hero-btn{width:100%;padding:10px 14px}
    .hero-nav{width:34px;height:34px}
    .grid-4{grid-template-columns:1fr 1fr}
    .grid-3{grid-template-columns:1fr}
    .name{font-size:14px}
    .title{font-size:24px}
    .showcase-wrap,.reviews-wrap{padding:12px}
    .btn-see-all{width:100%}
    .store-showcase-header{flex-direction:column;align-items:flex-start}
    .store-showcase-name{font-size:16px}
    /* –º–æ–±–∏–ª–µ ‚Äî 2 –∫–æ–ª–æ–Ω–∫–∏ */
  }
  @media (max-width:360px){
    .grid-4{grid-template-columns:1fr}
  }
</style>
{% endblock %}
{% block content %}
<section class="hero" id="hero">
  {% if active_banners %}
    {% for b in active_banners %}
      <div class="hero-bg" data-slide="{{ forloop.counter0 }}" style="background-image:url('{{ b.desktop_image_url }}');{% if not forloop.first %}display:none{% endif %}"></div>
    {% endfor %}
  {% else %}
    <div class="hero-bg" data-slide="0" style="background-image:url('/static/hero/today-desktop.svg');"></div>
  {% endif %}
  <div class="hero-inner">
    <div class="hero-card">
      {% if active_banners %}
        <h1 id="hero-title">{{ active_banners.0.title }}</h1>
        <p id="hero-caption" class="desc-text">{{ active_banners.0.caption }}</p>
        <p id="hero-overview" class="desc-text">{{ active_banners.0.overview }}</p>
        <a id="hero-btn" class="hero-btn" href="{{ active_banners.0.button_url|default:'/store/' }}">{{ active_banners.0.button_text|default:'–°–º–æ—Ç—Ä–µ—Ç—å –∫–∞—Ç–∞–ª–æ–≥' }}</a>
      {% else %}
        <h1 id="hero-title">–î–æ—Å—Ç–∞–≤–∫–∞ —Ü–≤–µ—Ç–æ–≤ –ø–æ –ú–∏–Ω—Å–∫—É</h1>
        <p id="hero-caption" class="desc-text">–ê–≤—Ç–æ—Ä—Å–∫–∏–µ –±—É–∫–µ—Ç—ã –∏ ONLINE –≤–∏—Ç—Ä–∏–Ω–∞ –Ω–∞ —Å–µ–≥–æ–¥–Ω—è</p>
        <p id="hero-overview" class="desc-text"></p>
        <a id="hero-btn" class="hero-btn" href="/store/">–°–º–æ—Ç—Ä–µ—Ç—å –∫–∞—Ç–∞–ª–æ–≥</a>
      {% endif %}
    </div>
  </div>
  {% if active_banners|length > 1 %}
    <button class="hero-nav hero-prev" id="hero-prev" type="button">&lt;</button>
    <button class="hero-nav hero-next" id="hero-next" type="button">&gt;</button>
    <div class="hero-dots" id="hero-dots">
      {% for b in active_banners %}
        <button type="button" class="hero-dot {% if forloop.first %}active{% endif %}" data-dot="{{ forloop.counter0 }}"></button>
      {% endfor %}
    </div>
  {% endif %}
</section>

<main class="container">
  <section class="section">
    <div class="showcase-wrap">
      <h2 class="title">–°–µ–≥–æ–¥–Ω—è –≤ –Ω–∞–ª–∏—á–∏–∏</h2>
      <p class="subtitle desc-text">ONLINE –≤–∏—Ç—Ä–∏–Ω–∞ ‚Äî —Ç–æ–≤–∞—Ä—ã –∏–∑ –Ω–∞—à–∏—Ö –º–∞–≥–∞–∑–∏–Ω–æ–≤, —Å–æ–±—Ä–∞–Ω–Ω—ã–µ —Å–µ–≥–æ–¥–Ω—è –ø—Ä—è–º–æ –∏–∑ —Ö–æ–ª–æ–¥–∏–ª—å–Ω–∏–∫–∞.</p>

      {% if store_showcases %}
        {% for ss in store_showcases %}
        <div class="store-showcase">
          <div class="store-showcase-header">
            <div class="store-showcase-meta">
              <div class="store-showcase-icon">üå∏</div>
              <div class="store-showcase-texts">
                <p class="store-showcase-name">{{ ss.store.name }}</p>
                {% if ss.store.address %}<p class="store-showcase-addr">üìç {{ ss.store.address }}</p>{% endif %}
              </div>
            </div>
            <a class="btn-see-all" href="/store/?store={{ ss.store.id }}">–°–º–æ—Ç—Ä–µ—Ç—å –≤—Å–µ ‚Üí</a>
          </div>
          <div class="grid grid-4 showcase-grid" id="showcase-grid-{{ forloop.counter }}">
            {% for p in ss.cards %}
              <a class="product-card card showcase-card" href="{{ p.href }}">
                <div class="media">
                  <img class="main" src="{{ p.image }}" alt="{{ p.title }}">
                  <img class="hover" src="{{ p.hover_image }}" alt="{{ p.title }}">
                  <span class="badge-instock">–í –Ω–∞–ª–∏—á–∏–∏</span>
                </div>
                <div class="pad">
                  <p class="name">{{ p.title }}</p>
                  <div class="price-row">
                    {% if p.price %}
                      <p class="price-tag" style="margin:0">
                        <span class="price-amount">{{ p.price|floatformat:"-2" }}</span>
                        <span class="price-currency">BYN</span>
                      </p>
                    {% else %}
                      <span class="price-undef">–¶–µ–Ω—É —É—Ç–æ—á–Ω—è–π—Ç–µ</span>
                    {% endif %}
                    <span class="order-btn">–ö—É–ø–∏—Ç—å</span>
                  </div>
                </div>
              </a>
            {% endfor %}
          </div>
          {% if ss.cards|length > 4 %}
          <button class="btn-expand-showcase" onclick="expandShowcase(this,'showcase-grid-{{ forloop.counter }}')">
            –°–º–æ—Ç—Ä–µ—Ç—å –≤—Å—é –≤–∏—Ç—Ä–∏–Ω—É ‚Üí
          </button>
          {% endif %}
          {% if not forloop.last %}<hr class="showcase-divider">{% endif %}
        </div>
        {% endfor %}
      {% else %}
        {% for p in showcase_cards %}
          <a class="product-card card" href="{{ p.href }}">
            <div class="media">
              <img class="main" src="{{ p.image }}" alt="{{ p.title }}">
              <img class="hover" src="{{ p.hover_image }}" alt="{{ p.title }}">
              <span class="badge-instock">–í –Ω–∞–ª–∏—á–∏–∏</span>
            </div>
            <div class="pad">
              <p class="name">{{ p.title }}</p>
              <div class="price-row">
                {% if p.price %}
                  <p class="price-tag" style="margin:0">
                    <span class="price-amount">{{ p.price|floatformat:"-2" }}</span>
                    <span class="price-currency">BYN</span>
                  </p>
                {% else %}
                  <span class="price-undef">–¶–µ–Ω—É —É—Ç–æ—á–Ω—è–π—Ç–µ</span>
                {% endif %}
                <span class="order-btn">–ö—É–ø–∏—Ç—å</span>
              </div>
            </div>
          </a>
        {% empty %}
          <p class="muted" style="margin-top:16px">–ü–æ–∫–∞ –Ω–µ—Ç —Ç–æ–≤–∞—Ä–æ–≤ –≤ ONLINE –≤–∏—Ç—Ä–∏–Ω–µ.</p>
        {% endfor %}
      {% endif %}
    </div>
  </section>

  <section class="section" style="padding-top:6px">
    <h2 class="title">–ö–∞—Ç–µ–≥–æ—Ä–∏–∏ –∫–∞—Ç–∞–ª–æ–≥–∞</h2>
    <p class="subtitle desc-text">–í—ã–±–µ—Ä–∏—Ç–µ —Ä–∞–∑–¥–µ–ª –∏ –ø–µ—Ä–µ–π–¥–∏—Ç–µ –≤ –ø–æ–¥—Ö–æ–¥—è—â—É—é –ø–æ–¥–±–æ—Ä–∫—É –±—É–∫–µ—Ç–æ–≤.</p>
    <div class="grid grid-4" style="margin-top:18px">
      {% for c in category_cards %}
        <a href="{{ c.href }}" class="category-card card">
          <div class="media">
            <img class="main" src="{{ c.image }}" alt="{{ c.name }}">
            <img class="hover" src="{{ c.hover_image }}" alt="{{ c.name }}">
          </div>
          <div class="pad">
            <p class="name">{{ c.name }}</p>
          </div>
        </a>
      {% empty %}
        <p class="muted">–ö–∞—Ç–µ–≥–æ—Ä–∏–∏ –ø–æ–∫–∞ –Ω–µ –∑–∞–ø–æ–ª–Ω–µ–Ω—ã.</p>
      {% endfor %}
    </div>
    <div class="action-center">
      <a class="btn-main" href="/store/">–í—Å–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏</a>
    </div>
  </section>

  <section class="section" style="padding-top:10px">
    <div class="reviews-wrap">
      <h2 class="title" style="font-size:34px">–û—Ç–∑—ã–≤—ã –∫–ª–∏–µ–Ω—Ç–æ–≤</h2>
      <p class="subtitle desc-text">–†–∞–∑–¥–µ–ª –∑–∞–ø–æ–ª–Ω—è–µ—Ç—Å—è –∏–∑ –∞–¥–º–∏–Ω–∫–∏ Django.</p>

      {% if reviews %}
      <div class="reviews-slider-wrap" id="reviewsSlider">
        <div class="reviews-track-outer">
          <div class="reviews-track" id="reviewsTrack">
            {% for r in reviews %}
            <article class="review-card">
              <div class="pad">
                <div class="review-top">
                  {% if r.image %}
                    <img class="avatar" src="{{ r.image }}" alt="{{ r.author }}">
                  {% else %}
                    <div class="avatar"></div>
                  {% endif %}
                  <div>
                    <div style="font-weight:700;color:var(--PrimaryDark)">{{ r.company|default:r.author }}</div>
                    <div class="muted" style="font-size:12px">{{ r.author }}</div>
                  </div>
                </div>
                <p class="desc-text" style="margin:10px 0 8px;line-height:1.45">{{ r.text|truncatechars:180 }}</p>
                <div class="stars">
                  {% if r.rating == 5 %}‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ{% elif r.rating == 4 %}‚òÖ‚òÖ‚òÖ‚òÖ‚òÜ{% elif r.rating == 3 %}‚òÖ‚òÖ‚òÖ‚òÜ‚òÜ{% elif r.rating == 2 %}‚òÖ‚òÖ‚òÜ‚òÜ‚òÜ{% else %}‚òÖ‚òÜ‚òÜ‚òÜ‚òÜ{% endif %}
                </div>
              </div>
            </article>
            {% endfor %}
          </div>
        </div>
        <div class="reviews-nav">
          <div class="reviews-dots" id="reviewsDots"></div>
          <button class="reviews-arrow" id="revPrev" aria-label="–ù–∞–∑–∞–¥">&#8592;</button>
          <button class="reviews-arrow" id="revNext" aria-label="–í–ø–µ—Ä—ë–¥">&#8594;</button>
        </div>
      </div>
      {% else %}
        <p class="muted" style="margin-top:16px">–û—Ç–∑—ã–≤–æ–≤ –ø–æ–∫–∞ –Ω–µ—Ç.</p>
      {% endif %}

      <div style="margin-top:18px">
        <a href="/reviews/" class="btn-main" style="display:inline-block;background:var(--PrimaryDark);color:#fff;border-radius:999px;padding:10px 24px;font-size:14px;font-weight:600;text-decoration:none">–û—Å—Ç–∞–≤–∏—Ç—å –æ—Ç–∑—ã–≤</a>
      </div>

      <div class="stores">
        {% for store in stores %}
          <span class="store-chip">{{ store.name }}{% if store.subdomain %} ¬∑ {{ store.subdomain }}{% endif %}</span>
        {% endfor %}
      </div>
    </div>
  </section>
</main>
{% endblock %}
{% block extra_scripts %}
<script>
function expandShowcase(btn, gridId) {
  var grid = document.getElementById(gridId);
  if (grid) { grid.classList.add('expanded'); }
  btn.style.display = 'none';
}
</script>
{% if active_banners|length > 1 %}
<script>
  (function(){
    const slides = Array.from(document.querySelectorAll(".hero-bg"));
    const dots = Array.from(document.querySelectorAll(".hero-dot"));
    const banners = [
      {% for b in active_banners %}
        {
          title: "{{ b.title|default:''|escapejs }}",
          caption: "{{ b.caption|default:''|escapejs }}",
          overview: "{{ b.overview|default:''|escapejs }}",
          buttonText: "{{ b.button_text|default:'–°–º–æ—Ç—Ä–µ—Ç—å –∫–∞—Ç–∞–ª–æ–≥'|escapejs }}",
          buttonUrl: "{{ b.button_url|default:'/store/'|escapejs }}"
        }{% if not forloop.last %},{% endif %}
      {% endfor %}
    ];
    const title = document.getElementById("hero-title");
    const caption = document.getElementById("hero-caption");
    const overview = document.getElementById("hero-overview");
    const btn = document.getElementById("hero-btn");
    const prev = document.getElementById("hero-prev");
    const next = document.getElementById("hero-next");
    let idx = 0;

    function paint(i){
      idx = i;
      slides.forEach((el, n) => { el.style.display = n === i ? "block" : "none"; });
      dots.forEach((d, n) => d.classList.toggle("active", n === i));
      title.textContent = banners[i].title || "";
      caption.textContent = banners[i].caption || "";
      overview.textContent = banners[i].overview || "";
      btn.textContent = banners[i].buttonText || "–°–º–æ—Ç—Ä–µ—Ç—å –∫–∞—Ç–∞–ª–æ–≥";
      btn.setAttribute("href", banners[i].buttonUrl || "/store/");
    }
    function nextSlide(){ paint((idx + 1) % slides.length); }
    function prevSlide(){ paint((idx - 1 + slides.length) % slides.length); }
    if (next) next.addEventListener("click", nextSlide);
    if (prev) prev.addEventListener("click", prevSlide);
    dots.forEach((d, n) => d.addEventListener("click", () => paint(n)));
    setInterval(nextSlide, 5000);
  })();
</script>
{% endif %}
{% if reviews %}
<script>
(function(){
  var track = document.getElementById('reviewsTrack');
  var dotsWrap = document.getElementById('reviewsDots');
  var btnPrev = document.getElementById('revPrev');
  var btnNext = document.getElementById('revNext');
  if (!track) return;

  var cards = Array.from(track.children);
  var total = cards.length;
  var idx = 0;

  function perPage() {
    var w = window.innerWidth;
    if (w <= 560) return 1;
    if (w <= 900) return 2;
    return 3;
  }

  function pageCount() { return Math.ceil(total / perPage()); }

  function buildDots() {
    dotsWrap.innerHTML = '';
    var pc = pageCount();
    for (var i = 0; i < pc; i++) {
      var d = document.createElement('button');
      d.className = 'reviews-dot' + (i === 0 ? ' active' : '');
      d.setAttribute('aria-label', '–°—Ç—Ä–∞–Ω–∏—Ü–∞ ' + (i + 1));
      (function(n){ d.addEventListener('click', function(){ go(n); }); })(i);
      dotsWrap.appendChild(d);
    }
  }

  function go(page) {
    var pc = pageCount();
    idx = Math.max(0, Math.min(page, pc - 1));
    var pp = perPage();
    var cardW = cards[0].getBoundingClientRect().width;
    var gap = 16;
    track.style.transform = 'translateX(-' + (idx * pp * (cardW + gap)) + 'px)';
    Array.from(dotsWrap.children).forEach(function(d, n) {
      d.classList.toggle('active', n === idx);
    });
  }

  buildDots();
  btnPrev.addEventListener('click', function(){ go(idx - 1); });
  btnNext.addEventListener('click', function(){ go(idx + 1); });

  var resizeTimer;
  window.addEventListener('resize', function(){
    clearTimeout(resizeTimer);
    resizeTimer = setTimeout(function(){
      buildDots();
      go(0);
    }, 150);
  });
})();
</script>
{% endif %}
{% endblock %}
